import time
import logging
import argparse
import pygame
import pygame.freetype  # Import the freetype module.
import os
import sys
import numpy as np
import subprocess
import signal
import requests
import io
from PIL import Image

import spotipy
from spotipy.oauth2 import SpotifyOAuth

if __name__ == "__main__":
    SCREEN_SIZE = (320, 240)

    pygame.init()
    pygame.font.init()
    pygame.mouse.set_visible(False)

    root = os.path.dirname(os.path.abspath(__file__))
    whitrabt_10 = pygame.font.Font(root + '/../assets/fonts/whitrabt.ttf', 10)
    whitrabt_20 = pygame.font.Font(root + '/../assets/fonts/whitrabt.ttf', 20)
    oblivious_70 = pygame.font.Font(root + '/../assets/fonts/ObliviousFont.ttf', 70)

    screen = pygame.display.set_mode(SCREEN_SIZE)
    screen.fill((0,0,0))

    spotify = spotipy.Spotify(auth='')

    track = spotify.current_user_playing_track()
    artist = track['item']['artists'][0]['name']
    image = track['item']['album']['images'][2]
    name = track['item']['name']

    response = requests.get(image['url'])
    albom_cover_image = Image.open(io.BytesIO(response.content)).convert("RGBA")
    albom_cover_pyimage = pygame.image.fromstring(albom_cover_image.tobytes(), albom_cover_image.size, albom_cover_image.mode)

    running = True

    now_playing_text = whitrabt_20.render("Now playing...", True, (255, 255, 255))
    artist_name_text = whitrabt_20.render(artist, True, (255, 255, 255))
    track_name_text = whitrabt_10.render(name, True, (255, 255, 255))
    
    # screen.blit(now_playing_text, (120, 30))
    screen.blit(artist_name_text, (100, 20))
    screen.blit(track_name_text, (100, 40))
    screen.blit(albom_cover_pyimage, (20, 20))

    while running:
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                running = False
        
        
        pygame.display.update()

    pygame.quit()
